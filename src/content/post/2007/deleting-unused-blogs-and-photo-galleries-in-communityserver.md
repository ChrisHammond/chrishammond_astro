---
title: "Deleting unused blogs and photo galleries in CommunityServer."
author: Chris Hammond
publishDate: 2007-02-12T16:23:00
updateDate: 2008-01-23T16:51:05
tags: [ 'aspnet', 'Community Server', 'SQL Server' ]
excerpt: "I decided to remove some unused blogs and photo galleries from a few of my CommunityServer sites today. Here&#39;s some ROUGH SQL code to do it.It worked for me, but I make no guarantees how it will work for you! Backup your database before performing any type of maintenance.Be sure to sub in your UserId where I note below with the ##. I run the commented out code first at the top, this creates a quick table, after doing my testing I commit the changes then drop the table I had created.I don&#39;t claim this code is great, but it got the job done :D/*create table temp_deletesections(SectionId int,Processed int default 0)*/begin tran tran--rollbackdeclare @rowsAdded intinsert into temp_deletesections @rowsAdded intinsert into temp_deletesections into temp_deletesectionsselect sectionid, 0 from cs_sections sectionid, 0 from cs_sectionswhere totalposts &lt;1 totalposts &lt;1set @rowsAdded = @@rowcount @rowsAdded = @@rowcountwhile @rowsAdded &gt; 0begindeclare @sectionDeleteId intselect top 1 @sectionDeleteId = sectionId from temp_deletesections where processed=0 @rowsAdded &gt; 0begindeclare @sectionDeleteId intselect top 1 @sectionDeleteId = sectionId from temp_deletesections where processed=0begindeclare @sectionDeleteId intselect top 1 @sectionDeleteId = sectionId from temp_deletesections where processed=0 @sectionDeleteId intselect top 1 @sectionDeleteId = sectionId from temp_deletesections where processed=0 top 1 @sectionDeleteId = sectionId from temp_deletesections where processed=0exec dbo.cs_Section_CreateUpdateDelete @SectionID=@sectionDeleteId,@DeleteForum=1,@SettingsID=1000,@UserID=## dbo.cs_Section_CreateUpdateDelete @SectionID=@sectionDeleteId,@DeleteForum=1,@SettingsID=1000,@UserID=##update temp_deletesections set Processed = 1 where Processed = 0 and sectionId = @sectionDeleteId temp_deletesections set Processed = 1 where Processed = 0 and sectionId = @sectionDeleteIdset @rowsAdded = @rowsAdded-1 @rowsAdded = @rowsAdded-1end--commit--drop table temp_deletesections&nbsp; Posted from..."
url: /2007/deleting-unused-blogs-and-photo-galleries-in-communityserver  # Use the generated URL with year
---
<p>I decided to remove some unused blogs and photo galleries from a few of my CommunityServer sites today. Here&#39;s some ROUGH SQL code to do it.</p><p>It worked for me, but I make no guarantees how it will work for you! Backup your database before performing any type of maintenance.</p><p>Be sure to sub in your UserId where I note below with the ##. I run the commented out code first at the top, this creates a quick table, after doing my testing I commit the changes then drop the table I had created.</p><p>I don&#39;t claim this code is great, but it got the job done :D</p><font color="#008000" size="2"><p>/*</p><p>create table temp_deletesections</p><p>(</p><p>SectionId int,</p><p>Processed int default 0</p><p>)</p><p>*/</p></font><font color="#0000ff" size="2"><p>begin<font size="2"> </font><font color="#0000ff" size="2">tran</font></p></font><font size="2"> </font><font color="#0000ff" size="2">tran</font><font color="#008000" size="2"><p>--rollback</p></font><font color="#0000ff" size="2"><p>declare<font size="2"> @rowsAdded </font><font color="#0000ff" size="2">int<p>insert<font size="2"> </font><font color="#0000ff" size="2">into</font><font size="2"> temp_deletesections</font></p></font></p></font><font size="2"> @rowsAdded </font><font color="#0000ff" size="2">int<p>insert<font size="2"> </font><font color="#0000ff" size="2">into</font><font size="2"> temp_deletesections</font></p></font><font size="2"> </font><font color="#0000ff" size="2">into</font><font size="2"> temp_deletesections</font><font color="#0000ff" size="2"><p>select<font size="2"> sectionid</font><font color="#808080" size="2">,</font><font size="2"> 0 </font><font color="#0000ff" size="2">from</font><font size="2"> cs_sections</font></p></font><font size="2"> sectionid</font><font color="#808080" size="2">,</font><font size="2"> 0 </font><font color="#0000ff" size="2">from</font><font size="2"> cs_sections</font><font color="#0000ff" size="2"><p>where<font size="2"> totalposts </font><font color="#808080" size="2">&lt;</font><font size="2">1</font></p></font><font size="2"> totalposts </font><font color="#808080" size="2">&lt;</font><font size="2">1</font><font color="#0000ff" size="2"><p>set<font size="2"> @rowsAdded </font><font color="#808080" size="2">=</font><font size="2"> </font><font color="#ff00ff" size="2">@@rowcount</font></p></font><font size="2"> @rowsAdded </font><font color="#808080" size="2">=</font><font size="2"> </font><font color="#ff00ff" size="2">@@rowcount</font><font color="#0000ff" size="2"><p>while<font size="2"> @rowsAdded </font><font color="#808080" size="2">&gt;</font><font size="2"> 0<p><font color="#0000ff" size="2">begin<p>declare<font size="2"> @sectionDeleteId </font><font color="#0000ff" size="2">int<p>select<font size="2"> </font><font color="#0000ff" size="2">top</font><font size="2"> 1 @sectionDeleteId </font><font color="#808080" size="2">=</font><font size="2"> sectionId </font><font color="#0000ff" size="2">from</font><font size="2"> temp_deletesections </font><font color="#0000ff" size="2">where</font><font size="2"> processed</font><font color="#808080" size="2">=</font><font size="2">0</font></p></font></p></font></p></font></p></font><font size="2"> @rowsAdded </font><font color="#808080" size="2">&gt;</font><font size="2"> 0<p><font color="#0000ff" size="2">begin<p>declare<font size="2"> @sectionDeleteId </font><font color="#0000ff" size="2">int<p>select<font size="2"> </font><font color="#0000ff" size="2">top</font><font size="2"> 1 @sectionDeleteId </font><font color="#808080" size="2">=</font><font size="2"> sectionId </font><font color="#0000ff" size="2">from</font><font size="2"> temp_deletesections </font><font color="#0000ff" size="2">where</font><font size="2"> processed</font><font color="#808080" size="2">=</font><font size="2">0</font></p></font></p></font></p></font><font color="#0000ff" size="2">begin<p>declare<font size="2"> @sectionDeleteId </font><font color="#0000ff" size="2">int<p>select<font size="2"> </font><font color="#0000ff" size="2">top</font><font size="2"> 1 @sectionDeleteId </font><font color="#808080" size="2">=</font><font size="2"> sectionId </font><font color="#0000ff" size="2">from</font><font size="2"> temp_deletesections </font><font color="#0000ff" size="2">where</font><font size="2"> processed</font><font color="#808080" size="2">=</font><font size="2">0</font></p></font></p></font><font size="2"> @sectionDeleteId </font><font color="#0000ff" size="2">int<p>select<font size="2"> </font><font color="#0000ff" size="2">top</font><font size="2"> 1 @sectionDeleteId </font><font color="#808080" size="2">=</font><font size="2"> sectionId </font><font color="#0000ff" size="2">from</font><font size="2"> temp_deletesections </font><font color="#0000ff" size="2">where</font><font size="2"> processed</font><font color="#808080" size="2">=</font><font size="2">0</font></p></font><font size="2"> </font><font color="#0000ff" size="2">top</font><font size="2"> 1 @sectionDeleteId </font><font color="#808080" size="2">=</font><font size="2"> sectionId </font><font color="#0000ff" size="2">from</font><font size="2"> temp_deletesections </font><font color="#0000ff" size="2">where</font><font size="2"> processed</font><font color="#808080" size="2">=</font><font size="2">0</font><font color="#0000ff" size="2"><p>exec<font size="2"> dbo</font><font color="#808080" size="2">.</font><font size="2">cs_Section_CreateUpdateDelete @SectionID</font><font color="#808080" size="2">=</font><font size="2">@sectionDeleteId</font><font color="#808080" size="2">,</font><font size="2">@DeleteForum</font><font color="#808080" size="2">=</font><font size="2">1</font><font color="#808080" size="2">,</font><font size="2">@SettingsID</font><font color="#808080" size="2">=</font><font size="2">1000</font><font color="#808080" size="2">,</font><font size="2">@UserID</font><font color="#808080" size="2">=</font>##</p></font><font size="2"> dbo</font><font color="#808080" size="2">.</font><font size="2">cs_Section_CreateUpdateDelete @SectionID</font><font color="#808080" size="2">=</font><font size="2">@sectionDeleteId</font><font color="#808080" size="2">,</font><font size="2">@DeleteForum</font><font color="#808080" size="2">=</font><font size="2">1</font><font color="#808080" size="2">,</font><font size="2">@SettingsID</font><font color="#808080" size="2">=</font><font size="2">1000</font><font color="#808080" size="2">,</font><font size="2">@UserID</font><font color="#808080" size="2">=</font>##<font color="#0000ff" size="2"><p>update<font size="2"> temp_deletesections </font><font color="#0000ff" size="2">set</font><font size="2"> Processed </font><font color="#808080" size="2">=</font><font size="2"> 1 </font><font color="#0000ff" size="2">where</font><font size="2"> Processed </font><font color="#808080" size="2">=</font><font size="2"> 0 </font><font color="#808080" size="2">and</font><font size="2"> sectionId </font><font color="#808080" size="2">=</font><font size="2"> @sectionDeleteId</font></p></font><font size="2"> temp_deletesections </font><font color="#0000ff" size="2">set</font><font size="2"> Processed </font><font color="#808080" size="2">=</font><font size="2"> 1 </font><font color="#0000ff" size="2">where</font><font size="2"> Processed </font><font color="#808080" size="2">=</font><font size="2"> 0 </font><font color="#808080" size="2">and</font><font size="2"> sectionId </font><font color="#808080" size="2">=</font><font size="2"> @sectionDeleteId</font><font color="#0000ff" size="2"><p>set<font size="2"> @rowsAdded </font><font color="#808080" size="2">=</font><font size="2"> @rowsAdded</font><font color="#808080" size="2">-</font><font size="2">1</font></p></font><font size="2"> @rowsAdded </font><font color="#808080" size="2">=</font><font size="2"> @rowsAdded</font><font color="#808080" size="2">-</font><font size="2">1</font><font color="#0000ff" size="2"><p>end</p></font><font color="#008000" size="2"><p>--commit</p><p>--drop table temp_deletesections</p></font><p>&nbsp;</p> Posted from <A href="https://weblogs.asp.net/christoc/">weblogs.asp.net/christoc</a>
