---
title: "Part 7: CommunityServer to DotNetNuke handling URLs"
author: Chris Hammond
publishDate: 2012-01-19T15:04:39
updateDate: 2024-06-21T20:11:29
tags: [ 'communityserver', 'DotNetNuke' ]
excerpt: "So this is Part 7 of my CommunityServer to DotNetNuke blog series, unfortunately it is well over 7 months late, but better late than never I say. This will be a quick blog post talking about &ldquo;URLs&rdquo; and how you can handle the old CommunityServer URLs and redirect them to the proper DotNetNuke URLs. Why would you do this? SEO, bookmarks and existing links. You want people that try to access the CS urls to be redirected properly to the appropriate DotNetNuke URL, be it for a forum post, blog post, or other. This post isn't going to cover all the specifics, as there are too many possible variations based on the configuration of your specific website, but hopefully it will provide you an overview of how I handled things in my conversion, and get you on the way to handling them in your conversion. "
url: /2012/part-7-communityserver-to-dotnetnuke-handling-urls  # Use the generated URL with year
---
<p>So this is Part 7 of my CommunityServer to <a href="https://www.dotnetnuke.com">DotNetNuke</a> blog series, unfortunately it is well over 7 months late, but better late than never I say.</p>  <p>This will be a quick blog post talking about &ldquo;URLs&rdquo; and how you can handle the old CommunityServer URLs and redirect them to the proper DotNetNuke URLs. Why would you do this? SEO, bookmarks and existing links. You want people that try to access the CS urls to be redirected properly to the appropriate DotNetNuke URL, be it for a forum post, blog post, or other.</p>  <p>This post isn&#39;t going to cover all the specifics, as there are too many possible variations based on the configuration of your specific website, but hopefully it will provide you an overview of how I handled things in my conversion, and get you on the way to handling them in your conversion.</p>  <p>Previous Posts:<br /> Part 1: An Introduction<br /> Part 2: DotNetNuke Installation<br /> Part 3: Converting users from CommunityServer to DotNetNuke<br /> Part 4: Getting the conversion tables ready for CS&nbsp; to DNN<br /> Part 5: Moving Forum threads from CommunityServer to DotNetNuke<br /> Part 6: Community Server to DotNetNuke Moving Forum Replies and Attachments.</p>  <h2>Assumptions</h2>  <p>In order to do what I have done for URL handling you are going to need to purchase the URL Master module from Ifinity, you can find it here on Snowcovered. Without this you are going to have a hard time getting the URLs to work, I am sure it is possible, but I won&#39;t cover that here.</p>  <p>What I ended up doing for the URLs in my conversion was create an HTTPModule that I install into DotNetNuke, and then I tell URLMaster which url formats to ignore and let the HTTPModule handle the redirects for those URLs, I do this through a variety of settings. First let&#39;s cover the HTTPModule.</p>  <p>I also converted &ldquo;blog&rdquo; posts from CommunityServer into <a href="https://github.com/chrishammond/dnnsimplearticle/" target="_blank">DNNSimpleArticle</a> articles, I have an importer for that that hasn&#39;t been officially released, but the source can be found on Codeplex (github) as well. I&#39;ll try to do another blog post on using that importer, basically if I remember correctly it requires you to write a simple SQL select statement for your &ldquo;source&rdquo; and it will then generate Articles based on the returned results. &gt;You can see that in action in the btnSubmit_Click event.</p>  <p>There are a few things in this post that aren&#39;t specific to CommunityServer, but are in for other reasons. Primarily some PHP and CGI handling. I added these in because of &ldquo;hacks&rdquo; or attempted hacks from various bots that were hitting the site and throwing 404 errors. I tried to do some redirection on these to pass them to a DNN page rather than letting them die. You can remove/ignore most of those if you like.</p>  <h2>CSUrls HTTP Module</h2>  <p>I haven&#39;t done an official release for this module, but you can go and grab the source code for the <a href="https://github.com/ChrisHammond/CS2DNN">HTTPModule via Codeplex</a>. The HTTPModule uses my standard visual studio template, so you just need to compile the code in Release mode and it will do the packaging for you (into an installable ZIP file).</p>  <p>The HTTPModule is a pretty simple project, there is a <a href="https://github.com/ChrisHammond/CS2DNN">.DNN file</a> that controls the installation in DNN, adding the necessary info to the web.config file.</p>  <p>There is also a <a href="https://github.com/ChrisHammond/CS2DNN">HttpModule.cs in the Components folder</a> that does all the work. <strong>This class could definitely use some refactoring</strong> to clean things up, but here is the basic overview of what happens in there.</p>  <p>First we configure a Connectionstring from the DotNetNuke web.config file, and then we create a method to get the PortalId of the existing request, this is necessary within DNN for a variety of methods.</p>  <p>CsRead is the primary method for the class, it does the following.</p>  <ol>  <li>Gets the PortalId</li>  <li>Grabs the incoming URL</li>  <li>Looks for a csdir querystring parameter that is used in the SiteURLs.config file later to designate when a URL should be parsed by the httpmodule.</li>  <li>Looks for any CS urls that have a Tags querystring (QS) parameter and builds out a link to the DNN Search Results page</li>  <li>Looks for CS Urls that have a PostID QS, based on the PostId we do a lookup from the DNN forum_posts table and build out a URL for that DNN forum thread.</li>  <li>Looks for CS Urls that have a ForumID QS, build a DNN url for the appropriate Forum</li>  <li>Looks for CS Urls that have a GroupID QS, build a DNN url for the appropriate Forum Group</li>  <li>Look for CS Urls that have a PostName QS and then figure out the original CS post ID versus the new DnnSimpleArticle ID, build the corresponding URL</li>  <li>At the end of all this the URL that is built from the previous steps is handled with a 301 redirection, ideally sending the person to the appropriate DNN page (URL).</li> </ol>  <h2>URLMaster Settings</h2>  <p>In order to get URLMaster configured properly I had a lot of trial and error in my configuration, here are the two settings I had to configure on the Host/Friendly URL page.</p>  <p><strong>(useSiteUrlsRegex)</strong></p>  <pre class="csharpcode"> |ShowThread\.aspx|Redirect\.aspx|ShowPost\.aspx|thread/\d+\.aspx|post/\d+\.aspx|ShowForum\.aspx| /archive/\d{4}/\d{1,2}/\d{1,2}/[a-zA-Z0-9\-\._]*?\.aspx|contact\.php|cgi-bin|forums/rss.aspx</pre> <style type="text/css">.csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } </style> <p><strong>(doNotRedirectRegex)</strong></p>  <pre class="csharpcode"> d+\.aspx|ShowForum\.aspx|/archive/\d{4}/\d{1,2}/\d{1,2}/[a-zA-Z0-9\-\._]*?\.aspx|contact\.php |cgi-bin|forums/rss.aspx </pre>  <h2>SiteURLS.config</h2>  <p>Here is a list of changes I made to the SiteURLs.config file,</p> <style type="text/css">.csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } </style> <pre class="csharpcode"> &lt;RewriterRule&gt; &lt;LookFor&gt;.*/(\d+)/(\d+)/ShowThread.aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;PostID=$2&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/(\d+)/ShowPost.aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;PostID=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/thread/(\d+).aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;PostID=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/post/(\d+).aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;PostID=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/(\d+)/ShowThread.aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;PostID=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/(\d+)/ShowForum.aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;ForumID=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/archive/(\d{4})/(\d{1,2})/(\d{1,2})/([a-zA-Z0-9\-\._]*?)\.aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;PostName=$4&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/tags/([a-zA-Z0-9\-\._]*?)/<span class="kwrd">default</span>.aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;Tags=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/Forums/<span class="kwrd">default</span>.aspx?GroupId=(\d+)&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;GroupId=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/Forums/rss.aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/redirect.aspx?csdir=1&amp;amp;GroupId=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/TabId/(\d+)(.*)/rss.aspx&lt;/LookFor&gt; &lt;SendTo&gt;~/rss.aspx?TabId=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*Telerik.RadUploadProgressHandler.ashx(.*)&lt;/LookFor&gt; &lt;SendTo&gt;~/Telerik.RadUploadProgressHandler.ashx$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;[^?]*/TabId/(\d+)(.*)&lt;/LookFor&gt; &lt;SendTo&gt;~/Default.aspx?TabId=$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*BannerClickThrough.aspx(.*)&lt;/LookFor&gt; &lt;SendTo&gt;~/DesktopModules/Admin/Banners/BannerClickThrough.aspx$1&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*<span class="rem">/*.php&lt;/LookFor&gt;</span> <span class="rem">&lt;SendTo&gt;~/phpredirect.htm&lt;/SendTo&gt;</span> <span class="rem">&lt;/RewriterRule&gt;</span> <span class="rem">&lt;RewriterRule&gt;</span> <span class="rem">&lt;LookFor&gt;.*/</span>cgi-bin/.*&lt;/LookFor&gt; &lt;SendTo&gt;~/cgiredirect.htm&lt;/SendTo&gt; &lt;/RewriterRule&gt; &lt;RewriterRule&gt; &lt;LookFor&gt;.*/*.html&lt;/LookFor&gt; &lt;SendTo&gt;~/cgiredirect.htm&lt;/SendTo&gt; &lt;/RewriterRule&gt;</pre> <style type="text/css">.csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } </style> <h2>Redirect.aspx</h2>  <p>You might notice in the above SiteUrls.config changes I have a reference to redirect.aspx, I did create a simple ASPX file in the root of my website with the following contents. Basically it caught any errors that occurred, and then redirected people to a page I manually created in DotNetNuke called &ldquo;newsite&rdquo; that had some messages and links on the page. Basically I wanted to ensure that even if something went wrong, you still got sent to a page that provided information and links to access the new site.</p>  <pre class="csharpcode"> &lt;%@ Page Language=<span class="str">&quot;C#&quot;</span> AutoEventWireup=<span class="str">&quot;true&quot;</span> %&gt;  &lt;!DOCTYPE html PUBLIC <span class="str">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="str">&quot;https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;  &lt;script runat=<span class="str">&quot;server&quot;</span>&gt;     <span class="kwrd">private</span> <span class="kwrd">void</span> Page_Load(<span class="kwrd">object</span> sender, System.EventArgs e)     {         <span class="kwrd">try</span>         {                                   }         <span class="kwrd">catch</span>         {             <span class="kwrd">string</span> href = <span class="str">&quot;https://www.sccaforums.com/newsite.aspx&quot;</span>;             Response.Status = <span class="str">&quot;301 Moved Permanently&quot;</span>;                          Response.RedirectLocation = href;                      }     } &lt;/script&gt;  &lt;html xmlns=<span class="str">&quot;https://www.w3.org/1999/xhtml&quot;</span>&gt; &lt;head runat=<span class="str">&quot;server&quot;</span>&gt;     title SCCAForums.com &lt;/head&gt; &lt;body&gt;     &lt;form id=<span class="str">&quot;form1&quot;</span> runat=<span class="str">&quot;server&quot;</span>&gt;     &lt;div&gt;     &lt;/div&gt;     &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;</pre> <style type="text/css">.csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } </style> <h2>Old URLs and New URLs</h2>  <p>Here is an example of how the Forum URLs work in CS then in DNN.</p>  <p>Forum Thread<br /> CS: www.sccaforums.com/forums/3/372507/ShowThread.aspx<br /> DNN: www.sccaforums.com/forums/forumid/25/postid/41008/scope/posts</p>  <p>I intended to provide an example of how the blog urls worked as well, but in testing it looks like at least on <a href="https://www.SCCAForums.com" target="_blank">SCCAForums.com</a> the old blog URLs no longer work. I&#39;ll have to track down why that is, I am not TOO concerned about it, but probably should be. The reason I am not too concerned, I do know they worked for a long time, and looking around on Google I can&#39;t find any of the old URLs, so basically Google knows the new URLs and points people there. The problem I would run into is any old links for blogs, within existing blog posts, forum threads, or external sites, probably don&#39;t work.</p> 
