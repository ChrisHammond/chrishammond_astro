---
title: "After upgrading to DNN 7.1.2 Site Settings doesn't work"
author: Chris Hammond
publishDate: 2013-09-26T00:45:56
updateDate: 2013-09-26T00:51:04
tags: [ 'DNN', 'DotNetNuke', 'Error', 'Upgrade' ]
excerpt: "Troubleshoot problems encountered while upgrading websites to DNN 7.1.2. Post guides through issues related to SQL errors and DNN Inline Edit functionality."

---
<p>I upgraded a number of websites to DNN 7.1.2 tonight, and I ran into two different problems, this blog post will hopefully help you address the issues that I ran into, if you happen to run into them as well.</p> <p>Disclaimer: Always backup your website/database before making any changes or running any SQL scripts you got off the web. I don't take any responsibility for damage you cause to your own website, but <a href="https://www.christoc.com/Contact" target="_blank">if you need consulting help with your DNN site, I am available</a>.</p> <h2>Problem #1</h2> <p>During the upgrade process on 2 of 10 installs I upgraded tonight, the 07.01.02.sqldataprovider file had an error, the error gets logged into the <strong>Providers\DataProviders\SqlDataProvider</strong> folder in the <strong>07.01.02.log.resources</strong> file. The error is </p> <pre class="csharpcode"><style type="text/css">.csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } </style><div class="csharpcode"> <pre class="alt">System.<span class="kwrd">Data</span>.SqlClient.<span class="kwrd">SqlException</span> (0x80131904): Ambiguous <span class="kwrd">column</span> name <span class="str">'ModuleId'</span>.</pre> <pre>    <span class="kwrd">at</span> System.<span class="kwrd">Data</span>.SqlClient.SqlConnection.OnError(<span class="kwrd">SqlException</span> <span class="kwrd">exception</span>, <span class="kwrd">Boolean</span> breakConnection, <span class="kwrd">Action</span>`1 wrapCloseInAction)</pre> <pre class="alt">    <span class="kwrd">at</span> System.<span class="kwrd">Data</span>.SqlClient.SqlInternalConnection.OnError(<span class="kwrd">SqlException</span> <span class="kwrd">exception</span>, <span class="kwrd">Boolean</span> breakConnection, <span class="kwrd">Action</span>`1 wrapCloseInAction)</pre> <pre>    <span class="kwrd">at</span> System.<span class="kwrd">Data</span>.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, <span class="kwrd">Boolean</span> callerHasConnectionLock, <span class="kwrd">Boolean</span> asyncClose)</pre> <pre class="alt">    <span class="kwrd">at</span> System.<span class="kwrd">Data</span>.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, <span class="kwrd">Boolean</span>&amp; dataReady)</pre> <pre>    <span class="kwrd">at</span> System.<span class="kwrd">Data</span>.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, <span class="kwrd">Boolean</span> async, Int32 timeout)</pre> <pre class="alt">    <span class="kwrd">at</span> System.<span class="kwrd">Data</span>.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 <span class="kwrd">completion</span>, String methodName, <span class="kwrd">Boolean</span> sendToPipe, Int32 timeout, <span class="kwrd">Boolean</span> asyncWrite)</pre> <pre>    <span class="kwrd">at</span> System.<span class="kwrd">Data</span>.SqlClient.SqlCommand.ExecuteNonQuery()</pre> <pre class="alt">    <span class="kwrd">at</span> DotNetNuke.<span class="kwrd">Data</span>.SqlDataProvider.ExecuteScriptInternal(String connectionString, String script)</pre> <pre>ClientConnectionId:cc490fb3-5518-4ff4-bd9a-6e6aa00ca0d7</pre> <pre class="alt">&nbsp;</pre> <pre> <span class="kwrd">CREATE</span> <span class="kwrd">PROCEDURE</span> dbo.[GetRecycleModules]</pre> <pre class="alt">&nbsp;</pre> <pre>@PortalID <span class="kwrd">int</span></pre> <pre class="alt">&nbsp;</pre> <pre> <span class="kwrd">AS</span></pre> <pre class="alt"> <span class="kwrd">SELECT</span>  OwnerPortalID, PortalID, vw_Modules.TabID, vw_Modules.TabModuleID, </pre> <pre>         vw_Modules.ModuleID, ModuleDefID, vw_Modules.ModuleOrder, vw_Modules.PaneName, vw_Modules.ModuleTitle, </pre> <pre class="alt">         vw_Modules.CacheTime, vw_Modules.CacheMethod, vw_Modules.Alignment, vw_Modules.Color, vw_Modules.Border, </pre> <pre>         vw_Modules.IconFile, AllTabs, vw_Modules.Visibility, vw_Modules.IsDeleted, vw_Modules.Header, </pre> <pre class="alt">         vw_Modules.Footer, StartDate, EndDate, vw_Modules.ContainerSrc, vw_Modules.DisplayTitle, </pre> <pre>         vw_Modules.DisplayPrint, vw_Modules.DisplaySyndicate, vw_Modules.IsWebSlice, vw_Modules.WebSliceTitle, </pre> <pre class="alt">         vw_Modules.WebSliceExpiryDate, vw_Modules.WebSliceTTL, InheritViewPermissions, IsShareable, </pre> <pre>         IsShareableViewOnly, DesktopModuleID, DefaultCacheTime, ModuleControlID, </pre> <pre class="alt">         BusinessControllerClass, IsAdmin, SupportedFeatures, ContentItemID, </pre> <pre>         [Content], ContentTypeID, ContentKey, Indexed, StateID, </pre> <pre class="alt">         vw_Modules.CreatedByUserID, vw_Modules.CreatedOnDate, LastContentModifiedOnDate, vw_Modules.UniqueId, </pre> <pre>         vw_Modules.VersionGuid, vw_Modules.DefaultLanguageGuid, vw_Modules.LocalizedVersionGuid, vw_Modules.CultureCode, </pre> <pre class="alt">         TabModules.LastModifiedByUserID, TabModules.LastModifiedOnDate</pre> <pre> <span class="kwrd">FROM</span>    vw_Modules <span class="kwrd">INNER</span> <span class="kwrd">JOIN</span></pre> <pre class="alt">         TabModules <span class="kwrd">ON</span> vw_Modules.TabModuleID = TabModules.TabModuleID</pre> <pre> <span class="kwrd">WHERE</span>  PortalId = @PortalID</pre> <pre class="alt"> <span class="kwrd">ORDER</span> <span class="kwrd">BY</span> ModuleId</pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre     {     font-size: small;     color: black;     font-family: consolas, "Courier New", courier, monospace;     background-color: #ffffff;     /*white-space: pre;*/     }     .csharpcode pre { margin: 0em; }     .csharpcode .rem { color: #008000; }     .csharpcode .kwrd { color: #0000ff; }     .csharpcode .str { color: #006080; }     .csharpcode .op { color: #0000c0; }     .csharpcode .preproc { color: #cc6633; }     .csharpcode .asp { background-color: #ffff00; }     .csharpcode .html { color: #800000; }     .csharpcode .attr { color: #ff0000; }     .csharpcode .alt     {     background-color: #f4f4f4;     width: 100%;     margin: 0em;     }     .csharpcode .lnum { color: #606060; } </style> </pre> <p>&nbsp;</p> <p>Which in laymen's terms, is that the "order by ModuleId" conflicts because SQL doesn't know which ModuleId to use. This is a fairly easy fix, you can run the following SQL in your favorite SQL query tool, or even the Host/SQL page of your DNN site. (if you are using a custom databaseOwner or objectQualifier in your web.config file, but sure to modify this SQL to match your database)</p> <div class="csharpcode"> <pre class="alt"><span class="kwrd">IF</span> <span class="kwrd">EXISTS</span> (<span class="kwrd">SELECT</span> * <span class="kwrd">FROM</span> dbo.sysobjects <span class="kwrd">WHERE</span> id = object_id(N<span class="str">'dbo.[GetRecycleModules]'</span>) <span class="kwrd">AND</span> OBJECTPROPERTY(id, N<span class="str">'IsPROCEDURE'</span>) = 1)</pre> <pre>   <span class="kwrd">DROP</span> <span class="kwrd">PROCEDURE</span> dbo.[GetRecycleModules]</pre> <pre class="alt"> <span class="kwrd">GO</span></pre> <pre>&nbsp;</pre> <pre class="alt"> <span class="kwrd">CREATE</span> <span class="kwrd">PROCEDURE</span> dbo.[GetRecycleModules]</pre> <pre>&nbsp;</pre> <pre class="alt">     @PortalID <span class="kwrd">int</span></pre> <pre>     </pre> <pre class="alt"> <span class="kwrd">AS</span></pre> <pre> <span class="kwrd">SELECT</span>  OwnerPortalID, PortalID, vw_Modules.TabID, vw_Modules.TabModuleID, </pre> <pre class="alt">         vw_Modules.ModuleID, ModuleDefID, vw_Modules.ModuleOrder, vw_Modules.PaneName, vw_Modules.ModuleTitle, </pre> <pre>         vw_Modules.CacheTime, vw_Modules.CacheMethod, vw_Modules.Alignment, vw_Modules.Color, vw_Modules.Border, </pre> <pre class="alt">         vw_Modules.IconFile, AllTabs, vw_Modules.Visibility, vw_Modules.IsDeleted, vw_Modules.Header, </pre> <pre>         vw_Modules.Footer, StartDate, EndDate, vw_Modules.ContainerSrc, vw_Modules.DisplayTitle, </pre> <pre class="alt">         vw_Modules.DisplayPrint, vw_Modules.DisplaySyndicate, vw_Modules.IsWebSlice, vw_Modules.WebSliceTitle, </pre> <pre>         vw_Modules.WebSliceExpiryDate, vw_Modules.WebSliceTTL, InheritViewPermissions, IsShareable, </pre> <pre class="alt">         IsShareableViewOnly, DesktopModuleID, DefaultCacheTime, ModuleControlID, </pre> <pre>         BusinessControllerClass, IsAdmin, SupportedFeatures, ContentItemID, </pre> <pre class="alt">         [Content], ContentTypeID, ContentKey, Indexed, StateID, </pre> <pre>         vw_Modules.CreatedByUserID, vw_Modules.CreatedOnDate, LastContentModifiedOnDate, vw_Modules.UniqueId, </pre> <pre class="alt">         vw_Modules.VersionGuid, vw_Modules.DefaultLanguageGuid, vw_Modules.LocalizedVersionGuid, vw_Modules.CultureCode, </pre> <pre>         TabModules.LastModifiedByUserID, TabModules.LastModifiedOnDate</pre> <pre class="alt"> <span class="kwrd">FROM</span>    vw_Modules <span class="kwrd">INNER</span> <span class="kwrd">JOIN</span></pre> <pre>         TabModules <span class="kwrd">ON</span> vw_Modules.TabModuleID = TabModules.TabModuleID</pre> <pre class="alt"> <span class="kwrd">WHERE</span>  PortalId = @PortalID</pre> <pre> <span class="kwrd">ORDER</span> <span class="kwrd">BY</span> vw_modules.ModuleId</pre> <pre class="alt">&nbsp;</pre> <pre>&nbsp;</pre> <pre class="alt"> /* <span class="kwrd">update</span> GetPortalsByUser <span class="kwrd">Procedure</span> */</pre> <pre> /*************************************/</pre> <pre class="alt">&nbsp;</pre> <pre> <span class="kwrd">IF</span>  <span class="kwrd">EXISTS</span> (<span class="kwrd">SELECT</span> * <span class="kwrd">FROM</span> sys.objects <span class="kwrd">WHERE</span> object_id = OBJECT_ID(N<span class="str">'dbo.[GetPortalsByUser]'</span>) <span class="kwrd">AND</span> type <span class="kwrd">in</span> (N<span class="str">'P'</span>, N<span class="str">'PC'</span>))</pre> <pre class="alt"><span class="kwrd">DROP</span> <span class="kwrd">PROCEDURE</span> dbo.[GetPortalsByUser]</pre> <pre> <span class="kwrd">GO</span></pre> <pre class="alt">&nbsp;</pre> <pre> <span class="kwrd">CREATE</span> <span class="kwrd">PROCEDURE</span> dbo.[GetPortalsByUser]</pre> <pre class="alt">@userID <span class="kwrd">int</span> </pre> <pre> <span class="kwrd">AS</span></pre> <pre class="alt">&nbsp;</pre> <pre><span class="kwrd">SELECT</span>     dbo.vw_Portals.*</pre> <pre class="alt"> <span class="kwrd">FROM</span>         dbo.UserPortals <span class="kwrd">INNER</span> <span class="kwrd">JOIN</span></pre> <pre>                       dbo.vw_Portals <span class="kwrd">ON</span> </pre> <pre class="alt">  dbo.UserPortals.PortalId = dbo.vw_Portals.PortalID</pre> <pre> <span class="kwrd">WHERE</span>     (dbo.UserPortals.UserId = @userID)</pre> <pre class="alt"><span class="kwrd">AND</span> (dbo.vw_Portals.DefaultLanguage = dbo.vw_Portals.CultureCode)</pre> <pre>&nbsp;</pre> <pre class="alt">&nbsp;</pre> <pre> <span class="kwrd">GO</span></pre> <pre class="alt"> /************************************************************/</pre> <pre> /*****              SqlDataProvider                     *****/</pre> <pre class="alt"> /************************************************************/</pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre { font-size: small; color: black; font-family: consolas, "Courier New", courier, monospace; background-color: #ffffff; /*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt { background-color: #f4f4f4; width: 100%; margin: 0em; } .csharpcode .lnum { color: #606060; } </style> <p>So that addresses problem #1, fixing the SQL script for DNN 7.1.2 that failed to run successfully.</p> <h2>Problem #2</h2> <p>After working with one of the sites I upgraded, I noticed that there were some mysterious Pencil images showing up, and I quickly realized that DNN now has Inline Edit functionality working again. This hasn't worked since the DNN5 days. I hate the inline edit functionality on any site that "other" people maintain, so I wanted to turn this functionality off. Here is where Problem 2 comes in, to turn off Inline Edit in DNN, you need to go to the Site Settings page under the Admin menu. When I went to the Admin/Site Settings page I was provided with this nice error.</p> <div class="csharpcode"> <pre class="alt">Error: Site Settings <span class="kwrd">is</span> currently unavailable. DotNetNuke.Services.Exceptions.ModuleLoadException: c:\SOMEPATHHERE\wwwroot\DesktopModules\<span class="kwrd">Admin</span>\Portals\SiteSettings.ascx.cs(594): error CS1502: The best overloaded method <span class="kwrd">match</span> <span class="kwrd">for</span> <span class="str">'FriendlyUrlSettings.FriendlyUrlSettings(DotNetNuke.Framework.Providers.Provider)'</span> has <span class="kwrd">some</span> invalid arguments ---&gt; System.Web.HttpCompileException: c:\SOMEPATHHERE\wwwroot\DesktopModules\<span class="kwrd">Admin</span>\Portals\SiteSettings.ascx.cs(594): error CS1502: The best overloaded method <span class="kwrd">match</span> <span class="kwrd">for</span> <span class="str">'FriendlyUrlSettings.FriendlyUrlSettings(DotNetNuke.Framework.Providers.Provider)'</span> has <span class="kwrd">some</span> invalid arguments <span class="kwrd">at</span> System.Web.Compilation.BuildManager.CompileWebFile(VirtualPath virtualPath) <span class="kwrd">at</span> System.Web.Compilation.BuildManager.GetVPathBuildResultInternal(VirtualPath virtualPath, <span class="kwrd">Boolean</span> noBuild, <span class="kwrd">Boolean</span> allowCrossApp, <span class="kwrd">Boolean</span> allowBuildInPrecompile, <span class="kwrd">Boolean</span> throwIfNotFound, <span class="kwrd">Boolean</span> ensureIsUpToDate) <span class="kwrd">at</span> System.Web.Compilation.BuildManager.GetVPathBuildResultWithNoAssert(HttpContext context, VirtualPath virtualPath, <span class="kwrd">Boolean</span> noBuild, <span class="kwrd">Boolean</span> allowCrossApp, <span class="kwrd">Boolean</span> allowBuildInPrecompile, <span class="kwrd">Boolean</span> throwIfNotFound, <span class="kwrd">Boolean</span> ensureIsUpToDate) <span class="kwrd">at</span> System.Web.Compilation.BuildManager.GetVPathBuildResult(HttpContext context, VirtualPath virtualPath, <span class="kwrd">Boolean</span> noBuild, <span class="kwrd">Boolean</span> allowCrossApp, <span class="kwrd">Boolean</span> allowBuildInPrecompile, <span class="kwrd">Boolean</span> ensureIsUpToDate) <span class="kwrd">at</span> System.Web.UI.TemplateControl.LoadControl(VirtualPath virtualPath) <span class="kwrd">at</span> DotNetNuke.UI.ControlUtilities.LoadControl[T](TemplateControl containerControl, String ControlSrc) <span class="kwrd">at</span> DotNetNuke.UI.Modules.WebFormsModuleControlFactory.CreateModuleControl(TemplateControl containerControl, ModuleInfo moduleConfiguration) <span class="kwrd">at</span> DotNetNuke.UI.Modules.ModuleControlFactory.LoadModuleControl(TemplateControl containerControl, ModuleInfo moduleConfiguration) <span class="kwrd">at</span> DotNetNuke.UI.Modules.ModuleHost.LoadModuleControl() --- <span class="kwrd">End</span> <span class="kwrd">of</span> <span class="kwrd">inner</span> <span class="kwrd">exception</span> stack trace ---</pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre { font-size: small; color: black; font-family: consolas, "Courier New", courier, monospace; background-color: #ffffff; /*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt { background-color: #f4f4f4; width: 100%; margin: 0em; } .csharpcode .lnum { color: #606060; } </style> <p>Isn't that nice and pretty? After doing some soul searching, I was able to track down the cause of the problem, and come up with a solution. The problem comes from the fact that I previously used the Ifinity FriendlyUrl Provider for DNN. Even though I am no longer using it, the DLL for the provider still exists within my installation's BIN folder. Something in DNN 7.1.2 changed, and now there is a conflict with this DLL. You'll need to delete the <strong>iFinity.FriendlyUrlProvider.dll</strong> from your website's BIN folder. You will also need to find any references to the DLL/NameSpaces in your web.config file. </p> <p>Replace this (this first one probably isn't used in IIS 7+ websites, but if your web.config has it, change it)</p> <p style="margin-left: 40px;"><em>&lt;add name="UrlRewrite" type="iFinity.DNN.Modules.FriendlyUrl.UrlRewriteModule, iFinity.FriendlyUrlProvider" /&gt;</em></p> <p>with this</p> <p style="margin-left: 40px;"><em>&lt;add name="UrlRewrite" type="DotNetNuke.HttpModules.UrlRewriteModule, DotNetNuke.HttpModules" /&gt;</em></p> <p>and replace this</p> <p style="margin-left: 40px;"><em>&lt;add name="UrlRewrite" type="iFinity.DNN.Modules.FriendlyUrl.UrlRewriteModule, iFinity.FriendlyUrlProvider" preCondition="managedHandler" /&gt;</em></p> <em></em> <p>with this</p> <p style="margin-left: 40px;"><em>&lt;add name="UrlRewrite" type="DotNetNuke.HttpModules.UrlRewriteModule, DotNetNuke.HttpModules" preCondition="managedHandler" /&gt;</em></p> <p>Then finally your friendlyUrl section of the web.config should most likely look like this</p> <div class="csharpcode"> <pre class="alt">&nbsp;</pre> <pre><span class="kwrd">&lt;</span><span class="html">friendlyUrl</span> <span class="attr">defaultProvider</span><span class="kwrd">="DNNFriendlyUrl"</span><span class="kwrd">&gt;</span></pre> <pre class="alt">    <span class="kwrd">&lt;</span><span class="html">providers</span><span class="kwrd">&gt;</span></pre> <pre>        <span class="kwrd">&lt;</span><span class="html">clear</span> <span class="kwrd">/&gt;</span></pre> <pre class="alt">         <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="DNNFriendlyUrl"</span> <span class="attr">type</span><span class="kwrd">="DotNetNuke.Services.Url.FriendlyUrl.DNNFriendlyUrlProvider, DotNetNuke.HttpModules"</span> <span class="attr">includePageName</span><span class="kwrd">="true"</span> <span class="attr">regexMatch</span><span class="kwrd">="[^a-zA-Z0-9 _-]"</span> <span class="attr">urlFormat</span><span class="kwrd">="Advanced"</span> <span class="kwrd">/&gt;</span></pre> <pre>    <span class="kwrd">&lt;/</span><span class="html">providers</span><span class="kwrd">&gt;</span></pre> <pre class="alt"><span class="kwrd">&lt;/</span><span class="html">friendlyUrl</span><span class="kwrd">&gt;</span></pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre { font-size: small; color: black; font-family: consolas, "Courier New", courier, monospace; background-color: #ffffff; /*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt { background-color: #f4f4f4; width: 100%; margin: 0em; } .csharpcode .lnum { color: #606060; } </style> <p>I hope that this blog post helps someone else save a little time, I spent quite a bit longer than I normally do with DNN upgrades tonight. </p>


