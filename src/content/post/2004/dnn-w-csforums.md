---
title: "DNN w/ CS::Forums"
author: Chris Hammond
publishDate: 2004-08-30T23:12:00
updateDate: 2008-01-23T16:50:47
tags: [ 'Development' ]
excerpt: "Learn how to integrate DNN and CommunityServer::Forums for user authentication in this instructional guide. Please note the known issues and risks involved."
url: /2004/dnn-w-csforums  # Use the generated URL with year
---
<P><EM><FONT color=#ff0000>All of the information below is provided at your own risk. Chris Hammond cannot be held responsible for any thing you break or ruin while trying to follow these steps. The information below is provided strictly for instructional purposes and should probably not be used in a production environment due to the Known Issues listed in the article below.</FONT></EM></P> <P>You can see the following changes in production at <A href="https://www.oakleyforums.com/">https://www.oakleyforums.com/</A> </P> <P>This is the process to get DNN and CommunityServer :: Forums running off of the same cookie, for user authentication purposes. It does not integrate the forums as a DNN Module. It is just a temporary solution, and should hopefully be replaced by a better solution once CommunityServer 1.0 and DotNetNuke V2.2 are released using the .Net 2.0 user provider model, sometime later this fall.</P> <P>This process is pretty specific, <EM>it will require a rebuild of the CS::Forums with the code changes below</EM>. The changes will only affect the components.dll file, so if you rebuild on a development server and deploy to a production server you should only need to deploy the components.dll file into the BIN directory of the Forums application Web folder. I could be talked into providing this new components.dll file for download if there is interest.</P> <P><FONT size=4>Requirements to get this to function.</FONT><BR>1. DNN 2.1.2<A href="https://www.dotnetnuke.com/">https://www.dotnetnuke.com</A></FONT><BR>2. CS::Forums 2.0 <A href="https://www.communityserver.org/">https://www.communityserver.org/</A><BR>3. Don't allow users to sign in through DNN's login page, make them signin to the forums login page.<BR>4. Have public registration turned on on your DNN site, meaning that users&nbsp;don't have to get a verification email to sign in to the site. This is required because of requirement #3.<BR>5. Don't allow users to edit their DNN profile.<BR>6. Turn off the forum setting that allows users to change their username (off by default).</P> <P><FONT size=4>Here is the flow of how things should work.</FONT><BR>When a user visits your site for the first time, they should click on a link to visit the forums, To register with the site click on the register link which will point to the DNN registration.<BR>Once they are registered with the site they will be sent back to the forums page (logged in as a DNN user), the forums will then check to see if they are authenticated, if so the forums app will check to see if their DNN user information is&nbsp;already in the forums user table, and add them if they are not.<BR>They will then be required to login to the forums using their DNN/Forums username and password. If they were to browse back to the home page of the site, the DNN app, they should still be authenticated.</P> <P><FONT color=#ff0000 size=4>Known Issues</FONT></P> <P>1. If the user were to clear their cookie for the site and come back to the site again, they would have to login through the forums login page. This would authenticate them with the forums, and even with DotNetNuke, but it would not add their DNN roles to their cookie, so even though they would be authenticated with DNN they would not have the proper roles associated to them, so any pages of your site that required a user to be in a specific DNN role would not function properly.</P> <P>2. Another problem occurs if the user were to follow this flow.</P> <BLOCKQUOTE dir=ltr> <P>Register with DNN<BR>Login to the forums with the new user.<BR>Logout of the forums, and log in to the forums again with a different DNN user.<BR>Their DNN cookie would still have the DNN role associated with it from the first user that was logged in, which could either be more, or less, access than they are supposed to have to the DNN site.</P></BLOCKQUOTE> <P>3. If a user changes their password with the forums it will not be changed with DNN, this has not been tested yet but is very likely to cause problems down the road.</P> <P>&nbsp;</P> <P><FONT size=5>Here are the steps to geting DNN CS::Forums functioning.</FONT></P> <P><FONT size=4>Setup CS::Forums</FONT><BR>Run the installation application, point the installation to the same DB that you either will be using for DNN, or already are using for DNN.</P> <P><FONT size=4>Setup DNN</FONT><BR>Setup DotNetNuke as prescribed by the DNN documentation.</P> <P><FONT size=4>Setup IIS</FONT><BR>Setup DNN as the root of your web site, <A href="https://www.oakleyforums.com/">https://www.oakleyforums.com/</A> for example.<BR>Setup /forums as a virtual directory pointing to your /web/ folder in the forums installation directory.</P> <P><FONT size=4>Setup Web.config files for each application.</FONT><BR>To get the cookie to work between the two applications you need to have the following information in your web.config file. The NAME attribute in the authentication mode must be the same in both applications.</P> <P>name=".DNNForums" </P> <P><STRONG>You also need to add the following line to each web.config<BR></STRONG><MACHINEKEY validation="SHA1" decryptionKey="AutoGenerate" validationKey="AutoGenerate" /><BR>That line overrides a setting in the machine.config file that prevents applications from sharing cookies.</P> <P><FONT size=4>CS::FORUMS changes</FONT></P> <P><STRONG>SiteUrls.config in the root of the web folder line 90: name=&#8220;user_Register&#8220;<BR>&nbsp;(note the ^ instead of an &amp;, the ^ will get replace when the URL is built)<BR></STRONG>Make the user_Register attribute's path <BR>/Default.aspx?tabid=1^ctl=Register&nbsp;<URL name="user_Register" path="/../dnnforums/Default.aspx?tabid=1^ctl=Register" /></P> <P><BR><STRONG>File: Resources.XML in web/languest/en-us/<BR>(This makes the &#8220;Home&#8220; link in the forum navigation say &#8220;Forum Home&#8220; so that users know where they will be sent when clicking on that link.)</STRONG></P> <P><STRONG>Find:<BR></STRONG>resources name = "Utility_ForumAnchorType_MenuHome"&gt;Home<BR><STRONG>Replace with&nbsp;<BR></STRONG>resources name = "Utility_ForumAnchorType_MenuHome"&gt;Forum Home</P> <P><BR><STRONG>File: forumsHttpModule.cs in Components/HttpModule/</STRONG><BR><STRONG>find around Line 235:</STRONG></P> <P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Find the user and get the Windows roles this user belongs to and asssign the proper permissions<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// in the forum database if appropriate<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User foundUser = Users.FindUserByUsername( userName );<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( foundUser.UserID == 0 ) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( AspNetForums.Configuration.ForumConfiguration.GetConfig().AllowAutoUserRegistration) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundUser.Username&nbsp;= userName;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundUser.Password&nbsp;= String.Empty;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundUser.Salt&nbsp;&nbsp;= String.Empty;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Users.Create( foundUser, false );</P> <P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( usingWindowsAuth ) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;principle.IsInRole( AspNetForums.Configuration.ForumConfiguration.GetConfig().AdminWindowsGroup ) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| (<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((WindowsPrincipal)principle).IsInRole( System.Security.Principal.WindowsBuiltInRole.Administrator )<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;AspNetForums.Configuration.ForumConfiguration.GetConfig().AssignLocalAdminsAdminRole<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Roles.AddUserToRole( foundUser.UserID, 1 );<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P> <P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// TDD would also need some way here to allow the same functionality as AllowLocalAdminsAdminRole for Passport<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// authenticated users. I'm not sure what Passport returns with the authentication but we need some way to allow<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// a user to get promoted to admin if they are using a special passport account. It may be that we only allow the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// first user to a site that is setup as passport authentication to be granted admin role automatically.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new ForumException(ForumExceptionType.UserInvalidCredentials, userName);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P> <P><BR><STRONG>Replace with</STRONG></P> <P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Find the user and get the Windows roles this user belongs to and asssign the proper permissions<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// in the forum database if appropriate<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User foundUser = Users.FindUserByUsername( userName );<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( foundUser.UserID == 0 ) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//the following looks for a DNN user, get's the user's information and populates foundUser with that information so a forum user can be created.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int dnnUserExists = -1;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get DNN user<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (Convert.ToInt32(userName) &gt;= 0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//change this if you are installing the forums for another portalId besides 0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int portalId = 0;</P> <P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//get forums configuration info to get the connection string<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ForumConfiguration forumsConfig = ForumConfiguration.GetConfig();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider sqlForumsProvider = (Provider) forumsConfig.Providers[forumsConfig.DefaultProvider];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Read the connection string for this provider<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string connectionString;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionString = sqlForumsProvider.Attributes["connectionString"];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using( System.Data.SqlClient.SqlConnection myConnection = new System.Data.SqlClient.SqlConnection(connectionString) ) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//build SQL command<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Data.SqlClient.SqlCommand myCommand = new System.Data.SqlClient.SqlCommand("dbo.GetUser", myConnection);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Data.SqlClient.SqlDataReader reader;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Mark the Command as a SPROC<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCommand.CommandType = System.Data.CommandType.StoredProcedure;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add Parameters to SPROC<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//PortalId<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//UserId can be found in the userName variable that was set earlier by the forums code. DNN uses <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//context.User.Identity.Name as the UserID while the forums uses is as the actual username, thus causing the main problem<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCommand.Parameters.Add("@PortalID", System.Data.SqlDbType.Int).Value = portalId;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCommand.Parameters.Add("@UserId", System.Data.SqlDbType.Int).Value =&nbsp; Convert.ToInt32(userName);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Execute the command<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myConnection.Open();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reader = myCommand.ExecuteReader();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (reader.Read())<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//go through the datareader and get the user's DNN information.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundUser.Username&nbsp;= (string)reader["UserName"];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundUser.Password&nbsp;= (string)reader["Password"];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundUser.Salt&nbsp;&nbsp;= String.Empty;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foundUser.Email = (string)reader["Email"];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//check if user already exists...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User foundUser2 = Users.FindUserByUsername( foundUser.Username );<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (foundUser2.UserID != 0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dnnUserExists = 1;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reader.Close();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myConnection.Close();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch (Exception ex)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//user not found or some other error<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P> <P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//check if autoregister is on and dnnUserExists or not<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( AspNetForums.Configuration.ForumConfiguration.GetConfig().AllowAutoUserRegistration &amp;&amp; dnnUserExists == -1) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Users.Create( foundUser, false );<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( usingWindowsAuth ) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;principle.IsInRole( AspNetForums.Configuration.ForumConfiguration.GetConfig().AdminWindowsGroup ) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| (<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((WindowsPrincipal)principle).IsInRole( System.Security.Principal.WindowsBuiltInRole.Administrator )<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;AspNetForums.Configuration.ForumConfiguration.GetConfig().AssignLocalAdminsAdminRole<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Roles.AddUserToRole( foundUser.UserID, 1 );<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P> <P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// TDD would also need some way here to allow the same functionality as AllowLocalAdminsAdminRole for Passport<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// authenticated users. I'm not sure what Passport returns with the authentication but we need some way to allow<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// a user to get promoted to admin if they are using a special passport account. It may be that we only allow the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// first user to a site that is setup as passport authentication to be granted admin role automatically.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new ForumException(ForumExceptionType.UserInvalidCredentials, userName);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</P> <P>After making the above change you will need to recompile the components project of the CS::Forums solution.</P> <P><FONT size=4>DNN Changes</FONT><BR>You should create a skin for DNN that does NOT include the [USER] and [LOGIN] skinObjects.<BR>&nbsp;Create a new tab on DNN called Login, install the magicRedirect module available from <A href="https://www.magicmodules.com/">https://www.magicmodules.com/</A> and have it redirect to your forums login page.<BR>&nbsp;Create a new tab on DNN called Forums, and have the magidRedirect module redirect to <A href="https://www.yoursite.com/forums/">https://www.yoursite.com/forums/</A></P> <P>Please let me know what you think of this. I will be honest, it is not a pretty solution, and hopefully not a permanent solution. If you upgrade to a new release of the Forums codebase you will lose the changes you made in this process. Knowing this, when DNN 2.2 and CS 1.0 are released, assuming the integration for the Forums and DNN users work out of the box, installing the upgraded versions of both DNN and CS 1.0 should wipe the above changes away, hopefully without any extra work, but not knowing how the final integration will work on the two projects <FONT color=#ff0000>you make all of the above changes with your own risk!</FONT></P>

