---
title: "Simple RESTful JSON web services with DotNetNuke"
author: Chris Hammond
publishDate: 2010-08-24T19:22:05
updateDate: 2013-10-10T11:59:54
tags: [ 'CMS', 'DNN', 'DotNetNuke', 'JSON', 'Web Services' ]
excerpt: "In case you missed it, there is a Hackathon that is going on right now (the submission deadline is tomorrow so you still have time to throw a quick mobile project together). As part of the Hackathon event in St. Louis last week I gave a brief presentation on how to quickly and easily add a RESTful JSON webservice to your modules, or even create a simple module to do this yourself. I have the source code for this presentation on Codeplex under the dnnweb project, https://dnnweb.codeplex.com/ Â "
url: /2010/simple-restful-json-web-services-with-dotnetnuke  # Use the generated URL with year
---
<p>In case you missed it, there is a <a href="https://www.chrishammond.com/blog/itemid/1966/mobile-dotnetnuke-hackathon-in-st-louis-missouri">hackathon</a> that is going on right now (the submission deadline is tomorrow so you still have time to throw a quick mobile project together).</p> <p>As part of the <a href="https://www.chrishammond.com/blog/itemid/1966/mobile-dotnetnuke-hackathon-in-st-louis-missouri">hackathon</a> event in St. Louis last week I gave a brief presentation on how to quickly and easily add a RESTful JSON webservice to your modules, or even create a simple module to do this yourself. I have the source code for this presentation on Codeplex under the dnnweb project, <a href="https://dnnweb.codeplex.com/">https://dnnweb.codeplex.com/</a> </p> <p>The idea behind this is that in order to create a mobile app that does something with DNN you likely need to expose some data, and why not do it in a very quick and easy way, with RESTFul implementations and JSON data that works very well with javascript. For an example project you should check out the DNN Pulse application that Joe blogged about earlier. </p> <p>The code is in C#, but is really simple, you should be able to get it into a VB project fairly easily. In this post I'm going to talk about the code and what is going on.</p> <p>One word of warning, this project that you can download an install is not using any type of authentication right now, you can add it to a site, and it someone calls svc/users they will get a list of all your users, it is just provided for sample purposes right now.</p> <p>The first thing is a quick modification to your web.config file, if you're using IIS7 you can easily setup an HTTPHandler that will allow your web service to respond to incoming requests, such as</p> <blockquote> <p>https://PORTALALIAS/svc/users      <br /> https://PORTALALIAS/svc/roles       <br /> https://PORTALALIAS/svc/user/USERNAME</p> </blockquote> <p>With DNN5 this becomes very easy to do in your module's manifest file. With the project linked above I have already made this change for you, here's the sample code for that configuration </p> <div class="csharpcode"> <pre class="alt"><span class="lnum">   1:  </span>        &lt;component type=<span class="str">"Config"</span>&gt;</pre> <pre><span class="lnum">   2:  </span>          &lt;config&gt;</pre> <pre class="alt"><span class="lnum">   3:  </span>            &lt;configFile&gt;web.config&lt;/configFile&gt;</pre> <pre><span class="lnum">   4:  </span>            &lt;install&gt;</pre> <pre class="alt"><span class="lnum">   5:  </span>              &lt;configuration&gt;</pre> <pre><span class="lnum">   6:  </span>                &lt;nodes&gt;</pre> <pre class="alt"><span class="lnum">   7:  </span>                  &lt;node path=<span class="str">"/configuration/system.web/httpHandlers"</span> action=<span class="str">"update"</span> key=<span class="str">"path"</span> collision=<span class="str">"overwrite"</span>&gt;</pre> <pre><span class="lnum">   8:  </span>                    &lt;add verb=<span class="str">"GET"</span> path=<span class="str">"svc/*"</span> type=<span class="str">"com.christoc.dnn.dnnwebservices.Services.GetHandler, dnnwebservices"</span> /&gt;</pre> <pre class="alt"><span class="lnum">   9:  </span>                  &lt;/node&gt;</pre> <pre><span class="lnum">  10:  </span>                  &lt;node path=<span class="str">"/configuration/system.webServer/handlers"</span> action=<span class="str">"update"</span> key=<span class="str">"name"</span> collision=<span class="str">"overwrite"</span>&gt;</pre> <pre class="alt"><span class="lnum">  11:  </span>                    &lt;add name=<span class="str">"DnnWebServicesGetHandler"</span> verb=<span class="str">"GET"</span> path=<span class="str">"svc/*"</span> type=<span class="str">"com.christoc.dnn.dnnwebservices.Services.GetHandler, dnnwebservices"</span> preCondition=<span class="str">"integratedMode"</span> /&gt;</pre> <pre><span class="lnum">  12:  </span>                  &lt;/node&gt;</pre> <pre class="alt"><span class="lnum">  13:  </span>                &lt;/nodes&gt;</pre> <pre><span class="lnum">  14:  </span>              &lt;/configuration&gt;</pre> <pre class="alt"><span class="lnum">  15:  </span>            &lt;/install&gt;</pre> <pre><span class="lnum">  16:  </span>            &lt;uninstall&gt;</pre> <pre class="alt"><span class="lnum">  17:  </span>              &lt;configuration&gt;</pre> <pre><span class="lnum">  18:  </span>                &lt;nodes /&gt;</pre> <pre class="alt"><span class="lnum">  19:  </span>              &lt;/configuration&gt;</pre> <pre><span class="lnum">  20:  </span>            &lt;/uninstall&gt;</pre> <pre class="alt"><span class="lnum">  21:  </span>          &lt;/config&gt;</pre> <pre><span class="lnum">  22:  </span>        &lt;/component&gt;</pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre     {     font-size: small;     color: black;     font-family: consolas, "Courier New", courier, monospace;     background-color: #ffffff;     /*white-space: pre;*/     }     .csharpcode pre { margin: 0em; }     .csharpcode .rem { color: #008000; }     .csharpcode .kwrd { color: #0000ff; }     .csharpcode .str { color: #006080; }     .csharpcode .op { color: #0000c0; }     .csharpcode .preproc { color: #cc6633; }     .csharpcode .asp { background-color: #ffff00; }     .csharpcode .html { color: #800000; }     .csharpcode .attr { color: #ff0000; }     .csharpcode .alt     {     background-color: #f4f4f4;     width: 100%;     margin: 0em;     }     .csharpcode .lnum { color: #606060; } </style> <p>&nbsp;</p> <p>&nbsp;</p> <p>The next thing you need to do is to setup the HTTPHandler itself, in the example code I setup the Get Handler which exists in Services/GetHandler.cs, you basically need to implement IHttpHandler on the class</p> <div class="csharpcode"> <pre class="alt"><span class="lnum">   1:  </span><span class="kwrd">public</span> <span class="kwrd">class</span> GetHandler : IHttpHandler</pre> <pre><span class="lnum">   2:  </span>    {</pre> <pre class="alt"><span class="lnum">   3:  </span>        <span class="preproc">#region</span> IHttpHandler Members</pre> <pre><span class="lnum">   4:  </span>&nbsp;</pre> <pre class="alt"><span class="lnum">   5:  </span>        <span class="kwrd">public</span> <span class="kwrd">bool</span> IsReusable</pre> <pre><span class="lnum">   6:  </span>        {</pre> <pre class="alt"><span class="lnum">   7:  </span>            get { <span class="kwrd">return</span> <span class="kwrd">false</span>; }</pre> <pre><span class="lnum">   8:  </span>        }</pre> <pre class="alt"><span class="lnum">   9:  </span>&nbsp;</pre> <pre><span class="lnum">  10:  </span>        <span class="kwrd">public</span> <span class="kwrd">void</span> ProcessRequest(HttpContext context)</pre> <pre class="alt"><span class="lnum">  11:  </span>        {</pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre     {     font-size: small;     color: black;     font-family: consolas, "Courier New", courier, monospace;     background-color: #ffffff;     /*white-space: pre;*/     }     .csharpcode pre { margin: 0em; }     .csharpcode .rem { color: #008000; }     .csharpcode .kwrd { color: #0000ff; }     .csharpcode .str { color: #006080; }     .csharpcode .op { color: #0000c0; }     .csharpcode .preproc { color: #cc6633; }     .csharpcode .asp { background-color: #ffff00; }     .csharpcode .html { color: #800000; }     .csharpcode .attr { color: #ff0000; }     .csharpcode .alt     {     background-color: #f4f4f4;     width: 100%;     margin: 0em;     }     .csharpcode .lnum { color: #606060; } </style> <p>&nbsp;</p> <p>In order to do the JSON side of things, which stands for JavaScript Object Notation, I pulled in an opensource library from codeplex, <a href="https://json.codeplex.com/">https://json.codeplex.com/</a>&nbsp;</p> <p>In the processing for the handler I setup some method calls, one for getting all users, get a specific user, and one for get all roles for a portal. These are pretty simple, here they are in the ProcessRequest implementation</p> <div class="csharpcode"> <pre class="alt"><span class="lnum">   1:  </span>&nbsp;</pre> <pre><span class="lnum">   2:  </span>        <span class="kwrd">public</span> <span class="kwrd">void</span> ProcessRequest(HttpContext context)</pre> <pre class="alt"><span class="lnum">   3:  </span>        {</pre> <pre><span class="lnum">   4:  </span>            HttpResponse response = context.Response;</pre> <pre class="alt"><span class="lnum">   5:  </span>            var written = <span class="kwrd">false</span>;</pre> <pre><span class="lnum">   6:  </span>&nbsp;</pre> <pre class="alt"><span class="lnum">   7:  </span>            <span class="rem">//because we're coming into a URL that isn't being handled by DNN we need to figure out the PortalId</span></pre> <pre><span class="lnum">   8:  </span>            SetPortalId(context.Request);</pre> <pre class="alt"><span class="lnum">   9:  </span>&nbsp;</pre> <pre><span class="lnum">  10:  </span>            <span class="rem">//get all roles for a portal</span></pre> <pre class="alt"><span class="lnum">  11:  </span>            <span class="kwrd">if</span>(context.Request.Url.AbsolutePath.IndexOf(<span class="str">"roles"</span>)&gt;0 &amp;&amp; written == <span class="kwrd">false</span>)</pre> <pre><span class="lnum">  12:  </span>            {</pre> <pre class="alt"><span class="lnum">  13:  </span>                response.Write(GetRolesJson(PortalId));</pre> <pre><span class="lnum">  14:  </span>                written = <span class="kwrd">true</span>;</pre> <pre class="alt"><span class="lnum">  15:  </span>            }</pre> <pre><span class="lnum">  16:  </span>&nbsp;</pre> <pre class="alt"><span class="lnum">  17:  </span>            <span class="rem">//get back a listing of </span></pre> <pre><span class="lnum">  18:  </span>            <span class="kwrd">if</span> (context.Request.Url.AbsolutePath.IndexOf(<span class="str">"users"</span>) &gt; 0 &amp;&amp; written == <span class="kwrd">false</span>)</pre> <pre class="alt"><span class="lnum">  19:  </span>            {</pre> <pre><span class="lnum">  20:  </span>                response.Write(GetUsersJson(PortalId));</pre> <pre class="alt"><span class="lnum">  21:  </span>                written = <span class="kwrd">true</span>;</pre> <pre><span class="lnum">  22:  </span>            }</pre> <pre class="alt"><span class="lnum">  23:  </span>&nbsp;</pre> <pre><span class="lnum">  24:  </span>            <span class="rem">//get back a single user</span></pre> <pre class="alt"><span class="lnum">  25:  </span>            <span class="kwrd">if</span> (context.Request.Url.AbsolutePath.IndexOf(<span class="str">"user"</span>) &gt; 0 &amp;&amp; written == <span class="kwrd">false</span>)</pre> <pre><span class="lnum">  26:  </span>            {</pre> <pre class="alt"><span class="lnum">  27:  </span>                <span class="rem">//get the username to lookup </span></pre> <pre><span class="lnum">  28:  </span>                response.Write(GetUserJson(PortalId, context.Request));</pre> <pre class="alt"><span class="lnum">  29:  </span>                written = <span class="kwrd">true</span>;</pre> <pre><span class="lnum">  30:  </span>            }</pre> <pre class="alt"><span class="lnum">  31:  </span>           </pre> <pre><span class="lnum">  32:  </span>        }</pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre     {     font-size: small;     color: black;     font-family: consolas, "Courier New", courier, monospace;     background-color: #ffffff;     /*white-space: pre;*/     }     .csharpcode pre { margin: 0em; }     .csharpcode .rem { color: #008000; }     .csharpcode .kwrd { color: #0000ff; }     .csharpcode .str { color: #006080; }     .csharpcode .op { color: #0000c0; }     .csharpcode .preproc { color: #cc6633; }     .csharpcode .asp { background-color: #ffff00; }     .csharpcode .html { color: #800000; }     .csharpcode .attr { color: #ff0000; }     .csharpcode .alt     {     background-color: #f4f4f4;     width: 100%;     margin: 0em;     }     .csharpcode .lnum { color: #606060; } </style> <p>And the implementation of one of those calls, which goes through the DNN API</p> <div class="csharpcode"> <pre class="alt"><span class="lnum">   1:  </span>        <span class="rem">///&lt;summary&gt;</span></pre> <pre><span class="lnum">   2:  </span>        <span class="rem">/// Return all users for a portal in formatted json string</span></pre> <pre class="alt"><span class="lnum">   3:  </span>        <span class="rem">/// &lt;/summary&gt;</span></pre> <pre><span class="lnum">   4:  </span>        <span class="rem">/// &lt;param name="portalId"&gt;portalid&lt;/param&gt;</span></pre> <pre class="alt"><span class="lnum">   5:  </span>        <span class="kwrd">private</span> <span class="kwrd">static</span> <span class="kwrd">string</span> GetUsersJson(<span class="kwrd">int</span> portalId)</pre> <pre><span class="lnum">   6:  </span>        {</pre> <pre class="alt"><span class="lnum">   7:  </span>            <span class="rem">//get a list of all roles and return it in json</span></pre> <pre><span class="lnum">   8:  </span>            var uc = <span class="kwrd">new</span> UserController();</pre> <pre class="alt"><span class="lnum">   9:  </span>            var users = UserController.GetUsers(portalId);</pre> <pre><span class="lnum">  10:  </span>            var usersOutput = <span class="kwrd">string</span>.Empty;</pre> <pre class="alt"><span class="lnum">  11:  </span>            <span class="kwrd">foreach</span> (var t <span class="kwrd">in</span> users)</pre> <pre><span class="lnum">  12:  </span>            {</pre> <pre class="alt"><span class="lnum">  13:  </span>                var output = JsonConvert.SerializeObject(t, Formatting.Indented);</pre> <pre><span class="lnum">  14:  </span>                usersOutput += output;</pre> <pre class="alt"><span class="lnum">  15:  </span>                </pre> <pre><span class="lnum">  16:  </span>            }</pre> <pre class="alt"><span class="lnum">  17:  </span>            <span class="kwrd">return</span> usersOutput;</pre> <pre><span class="lnum">  18:  </span>        }</pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre     {     font-size: small;     color: black;     font-family: consolas, "Courier New", courier, monospace;     background-color: #ffffff;     /*white-space: pre;*/     }     .csharpcode pre { margin: 0em; }     .csharpcode .rem { color: #008000; }     .csharpcode .kwrd { color: #0000ff; }     .csharpcode .str { color: #006080; }     .csharpcode .op { color: #0000c0; }     .csharpcode .preproc { color: #cc6633; }     .csharpcode .asp { background-color: #ffff00; }     .csharpcode .html { color: #800000; }     .csharpcode .attr { color: #ff0000; }     .csharpcode .alt     {     background-color: #f4f4f4;     width: 100%;     margin: 0em;     }     .csharpcode .lnum { color: #606060; } </style> <p>&nbsp;</p> <p>And one last thing, in order to make the various calls, you also need to know how to get your PortalId based on the incoming URL.</p> <div class="csharpcode"> <pre class="alt"><span class="lnum">   1:  </span>        <span class="rem">///&lt;summary&gt;</span></pre> <pre><span class="lnum">   2:  </span>        <span class="rem">/// Set the portalid, taking the current request and locating which portal is being called based on this request.</span></pre> <pre class="alt"><span class="lnum">   3:  </span>        <span class="rem">/// &lt;/summary&gt;</span></pre> <pre><span class="lnum">   4:  </span>        <span class="rem">/// &lt;param name="request"&gt;request&lt;/param&gt;</span></pre> <pre class="alt"><span class="lnum">   5:  </span>        <span class="kwrd">private</span> <span class="kwrd">void</span> SetPortalId(HttpRequest request)</pre> <pre><span class="lnum">   6:  </span>        {</pre> <pre class="alt"><span class="lnum">   7:  </span>&nbsp;</pre> <pre><span class="lnum">   8:  </span>            <span class="kwrd">string</span> domainName = DotNetNuke.Common.Globals.GetDomainName(request, <span class="kwrd">true</span>);</pre> <pre class="alt"><span class="lnum">   9:  </span>&nbsp;</pre> <pre><span class="lnum">  10:  </span>            <span class="kwrd">string</span> portalAlias = domainName.Substring(0,domainName.IndexOf(<span class="str">"/svc"</span>));</pre> <pre class="alt"><span class="lnum">  11:  </span>            PortalAliasInfo pai = PortalSettings.GetPortalAliasInfo(portalAlias);</pre> <pre><span class="lnum">  12:  </span>            <span class="kwrd">if</span> (pai != <span class="kwrd">null</span>)</pre> <pre class="alt"><span class="lnum">  13:  </span>                PortalId = pai.PortalID;            </pre> <pre><span class="lnum">  14:  </span>        }</pre> <pre class="alt"><span class="lnum">  15:  </span>&nbsp;</pre> <pre><span class="lnum">  16:  </span>        <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">int</span> PortalId { get; set; }</pre> </div> <style type="text/css">     .csharpcode, .csharpcode pre     {     font-size: small;     color: black;     font-family: consolas, "Courier New", courier, monospace;     background-color: #ffffff;     /*white-space: pre;*/     }     .csharpcode pre { margin: 0em; }     .csharpcode .rem { color: #008000; }     .csharpcode .kwrd { color: #0000ff; }     .csharpcode .str { color: #006080; }     .csharpcode .op { color: #0000c0; }     .csharpcode .preproc { color: #cc6633; }     .csharpcode .asp { background-color: #ffff00; }     .csharpcode .html { color: #800000; }     .csharpcode .attr { color: #ff0000; }     .csharpcode .alt     {     background-color: #f4f4f4;     width: 100%;     margin: 0em;     }     .csharpcode .lnum { color: #606060; } </style> <p>&nbsp;</p> <p>The rest of the module project right now doesn't do anything, eventually I will add authentication and some display functionality to the services and the module, but for now it's just something quickly put out there. Download it, tear it apart, and start working on your own web services.</p> <p>A reminder about the Hackathon, you don't have to submit a fully flushed out 100% complete program for the contest, the idea is to do something quick and easy, and also innovative.</p> <p>So get going, the <a href="https://www.chrishammond.com/blog/itemid/1966/mobile-dotnetnuke-hackathon-in-st-louis-missouri">hackathon</a> is in full swing! </p>
